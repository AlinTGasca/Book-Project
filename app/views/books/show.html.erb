<div class="container-fluid">
<h3>
  <%= @book.title%>
</h3>
<% if current_user.try(:admin?) %>
  <%= link_to 'Edit', edit_book_path(@book.id) %> |
  <%= link_to 'Destroy', book_delete_path(@book.id),
              method: :delete,
              :onclick=> "return confirm('Are you sure you want to delete this book from database?')" %>
  <% end %>
  <br>
  <% if @book.avatar.exists? %>
    <%= image_tag @book.avatar.url(:medium) %>
  <%else%> <%= image_tag('No_Image_Available.png', size: "300x300",alt: 'no_image') %>
  <% end %>
</p>
<% if user_signed_in? %>
  <% if UsersToBook.where(book_id: @book.id,user_id: current_user.id).exists? %>
    <div>Edit status: <br>
      <%= form_tag(book_update_list_path,method: :patch) do %>
    <p><%= label_tag"Score" %>
      <%= select_tag 'rating', options_for_select( @ratings.map {|s| [if s.score!=nil
                                                                             s.score
                                                                           else '(Nothing)'
                                                                           end,s.id]}, @book_rating ) %></p>
        <p><%= label_tag "Your Status" %>
          <%= select_tag 'shelves', options_for_select( @shelves.map {|s| [s.status,s.id]}, @book_shelf ) %></p>
    <%= submit_tag "Update" %></div>
        <%= link_to 'Edit Details', list_book_details_path(@book_list.id) %>
        <% end %>
  <% else %>
    <div>Add to list: <br>
      <%= form_tag(book_add_list_path, method: :post) do %>
    <p><%= label_tag"Score" %>
      <%= select_tag 'rating', options_for_select( @ratings.map {|s| [if s.score!=nil
                                                                     s.score
                                                                     else '(Nothing)'
                                                                   end,s.id]}, @book_rating  ) %></p>
        <p><%= label_tag "Your Status" %>
          <%= select_tag 'shelves', options_for_select( @shelves.map {|s| [s.status,s.id]}, @book_shelf ) %></p>

  <%= submit_tag "Add" %></div>
      <% end %>
  <% end %>
<% end %>

<div>
  <strong> Summary:</strong> <%=@book.description%>
  <br>
  <strong> Published in: </strong> <% if (@book.published) %>
    <%= @book.published%>
  <% else %>
    Unknown
  <% end %>
  <br>
  <strong>Authors: </strong><% if (@authors) %>
  <% @authors.each do |author| %>
      <% if @authors.last != author %>
    <%= link_to author.firstName+ " " + author.lastName, author_path(author) %> ,
        <% else %>
        <%= link_to author.firstName+ " " + author.lastName, author_path(author) %>
    <% end
      end
    end%>
</div>
  <% if user_signed_in? %>
<% if !Review.where(book_id: @book.id, user_id: current_user.id).exists?%>
  <div><%= link_to 'Write a review', review_new_path(params[:id])%></div>
      <% else %>
    Your Review:
      <% end end %>

<br>
  <br>
  Reviews:
  <br>
  <% @reviews.each do |review| %>
  <br>
    ----------------------
    <br>
    <% if User.find(review.user_id).avatar.exists? %>
      <%= image_tag User.find(review.user_id).avatar.url(:thumb) %>
    <%else%> <%= image_tag('No_Image_Available.png', size: "100x100",alt: 'no_image') %>
    <% end %>
    <%= review.user.username %>
    <% if user_signed_in?
        if current_user.id == review.user_id %>
     <%= link_to 'Edit', review_edit_path(review)%>
        <%= link_to 'Destroy', review_delete_path(review),
                    method: :delete,
                    :onclick=> "return confirm('Are you sure you want to delete this review?')" %>
        <% end%>
    <br>
    <%= link_to review_like_path(review), method: :put do %>
      Upvote
        <% if current_user.voted_up_on?(review) %>
        (You)
        <% end %>
    <% end %>

    <%= link_to review_dislike_path(review), method: :put do %>
      Downvote
        <% if current_user.voted_down_on?(review) %>
          (You)
        <% end %>
    <% end
       end%>
    <br>
    <%= review.get_upvotes.size.to_s + " out of " + (review.get_downvotes.size+review.get_upvotes.size).to_s + " users found this review helpful. "  %>

    <br>

    Score:  <%= review.rating.score %>
    <br>
    Review: <%= review.content %>
    <br>
    ----------------------
  <% end %>
</div>